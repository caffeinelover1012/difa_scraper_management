{% extends "datasets/base.html" %}
{% load custom_tags %}
{% load static %}
{% block title %}Datasets{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/custom.css' %}">

<div class="container mt-4">
  <h2>Datasets</h2>
  <input class="form-control mb-4" id="searchInput" type="text" placeholder="Search datasets">
  
  <div class="table-responsive">
    <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Last Scraped</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="datasetsTable">
      {% for dataset in datasets %}
      <tr>
        <td>{{ dataset.id }}</td>
        <td>{{ dataset.dataset_name }}</td>
        <td class="scraped-date" data-date="{{ dataset.last_scraped }}">{{ dataset.last_scraped }}</td>
        <td><a href="{% url 'dataset' dataset_id=dataset.id %}" class="btn btn-view">View</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.scraped-date').forEach(element => {
      const utcDateStr = element.getAttribute('data-date');
      // Convert to ISO 8601 format, e.g., "2023-12-28T11:42:20.335Z"
      const isoDateStr = utcDateStr.replace(' ', 'T').slice(0, -6) + 'Z';
      const localDate = new Date(isoDateStr);
      element.textContent = localDate.toLocaleString();
    });
  });
  </script>
  

<script src="{% static 'js/custom.js' %}"></script>
{% endblock %}
